<html>
<head>
	<title>EMPTY</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link href="css/style.css" rel="stylesheet" type="text/css" />
      <script type="text/javascript" src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=6.3"></script>
	<!--script type="text/javascript" src="jQuery/jquery-1.3.2.js"></script-->	
	<script type="text/javascript">
	var map = null;
    var dataLayer = new VEShapeLayer();
    var searchShapeLayer = new VEShapeLayer();
		
		 function hideEachShape()
         {
           for(var i=0;i<dataLayer.GetShapeCount();i++)
         {
           var shape = dataLayer.GetShapeByIndex(i);
           shape.Hide();
          }
         }
				 
			function radiusSearch() 
    {
      //hide previous results
          hideEachShape();
          
          //clear the search shape layer
          searchShapeLayer.DeleteAllShapes();
      
      //center of search Radius
      //var origin = new VELatLong(43.645,-79.389);
      var origin = new VELatLong(43.043140,-76.150520);
      
      //search radius in km
      var radius = 1;
      
      for(var i=0; i < dataLayer.GetShapeCount(); i++)
      {
        var shape = dataLayer.GetShapeByIndex(i);
        var latlong = shape.GetPoints()[0];
        
        var d = distance(origin,latlong);
      
        if(Math.abs(d)<= Math.abs(radius))
        {
          shape.Show();
        }
      }
      
      drawCircle(origin,radius);
    }

		function distance(latlong,latlong2)
    {
      var lat1 = latlong.Latitude;
      var lon1 = latlong.Longitude;
      var lat2 = latlong2.Latitude;
      var lon2 = latlong2.Longitude;
      var earthRadius = 6371;
      
      var factor = Math.PI/180;
      var dLat = (lat2-lat1)*factor;
      var dLon = (lon2-lon1)*factor; 
      var a = Math.sin(dLat/2) * Math.sin(dLat/2)+Math.cos(lat1*factor)*Math.cos(lat2*factor)*Math.sin(dLon/2) * Math.sin(dLon/2); 
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
      var d = earthRadius * c;
      
      return d;
    }
    
    function drawCircle(origin,radius)
    {  
      var earthRadius = 6371;
      
      //latitude in radians
        var lat = (origin.Latitude*Math.PI)/180; 
        
        //longitude in radians
        var lon = (origin.Longitude*Math.PI)/180; 
        
        //angular distance covered on earth's surface
        var d = parseFloat(radius)/earthRadius;  
        
        var points = new Array();
        for (i = 0; i <= 360; i++) 
        { 
            var point = new VELatLong(0,0)            
            var bearing = i * Math.PI / 180; //rad
            point.Latitude = Math.asin(Math.sin(lat)*Math.cos(d) + Math.cos(lat)*Math.sin(d)*Math.cos(bearing));
            point.Longitude = ((lon + Math.atan2(Math.sin(bearing)*Math.sin(d)*Math.cos(lat), Math.cos(d)-Math.sin(lat)*Math.sin(point.Latitude))) * 180) / Math.PI;
            point.Latitude = (point.Latitude * 180) / Math.PI;
            points.push(point);
						//document.write(points[i] + " ");
        }
        //document.write(points[90] + " | ");  document.write(points[180] + " | ");  document.write(points[270] + " | ");  document.write(points[0] + " | ");  
       var circle = new VEShape(VEShapeType.Polyline, points); 
       circle.HideIcon();
       searchShapeLayer.AddShape(circle);
       
       map.SetMapView(points);
    }
		
		radiusSearch();
	</script>
	<script type="text/javascript">
		Object.prototype.p = function(){
			
			return document.write("<p>" + this.valueOf() + "</p>");
			
		}
	</script>
</head>
<body>
<!-- http://msdn.microsoft.com/en-us/library/cc451895.aspx -->
	<script type="text/javascript">
/*	
	function AssertException(exp){ 
	this.exp = exp; 
	this.fail = function(){
		return "Fail: ".fontcolor("red") + this.exp;
	}
}

function assert(exp){
	if (!eval(exp)) {
		throw new AssertException(exp);
	}else {
		("Pass: ".fontcolor("green") + exp).p();
	}
}
*/
Array.prototype.Assertions = function(callback){
	
	for (var i=0; i < this.length; i++){
		callback(this[i]);
	}
	
}

// 43.645,-79.389
// 43.644999326824475, -79.37657207987483 | 43.63600678394081, -79.38900000000001 | 43.644999326824475, -79.40142792012516 | 43.65399321605919, -79.38900000000001 | 
var points = ['0,20','-20,0','0,-20','20,0'];
var coord = ['10,0','15,12','112,2','-14,1','27,-19'];
var coord2 = ['10,10','25,12','12,2','-14,1','27,-19'];


var test = function(test,points){
//var points = ['0,20','-20,0','0,-20','20,0'];
var points = this.points;
var north = points[0];
var northX = 1*north.split(',')[0];
var northY = 1*north.split(',')[1];

var west = points[1];
var westX = 1*west.split(',')[0];
var westY = 1*west.split(',')[1];

var south = points[2];
var southX = 1*south.split(',')[0];
var southY = 1*south.split(',')[1];

var east = points[3];
var eastX = 1*east.split(',')[0];
var eastY = 1*east.split(',')[1];


var testX = 1*test.split(',')[0];
var testY = 1*test.split(',')[1];

if (testX > westX && testX < eastX && testY > southY && testY < northY) {
	("Pass: ".fontcolor("green") + test).p();
	return true;
}else {
	("Fail: ".fontcolor("red") + test).p();
	return false;
}
}

"Testing coordinates within 20 units of 0,0".p();
coord.Assertions(test);
"Testing coordinates within 20 units of 0,0".p();
coord2.Assertions(test);
/*
function inRange(test){
var points = ['0,20','-20,0','0,-20','20,0'];
var north = points[0];
var northX = 1*north.split(',')[0];
var northY = 1*north.split(',')[1];

var west = points[1];
var westX = 1*west.split(',')[0];
var westY = 1*west.split(',')[1];

var south = points[2];
var southX = 1*south.split(',')[0];
var southY = 1*south.split(',')[1];

var east = points[3];
var eastX = 1*east.split(',')[0];
var eastY = 1*east.split(',')[1];


var testX = 1*test.split(',')[0];
var testY = 1*test.split(',')[1];

if (testX > westX && testX < eastX && testY > southY && testY < northY) {
	return true;
}else {
	return false;
}
}
*/
//inRange(coord[0]);
//alert('foo');
/*
function inRange(point,pxMax,pxMin,pyMax,pyMin){
	if (point > pxMin && point < pxMax) {
		return true;
	} else {
		return false;
	}
}
*/

//var units = ["inRange(coord[0])"];

//var units = ["testPoint2 > xMin && testPoint2 < xMax","testPoint2 > xMin && testPoint2 < xMax"];
/*
units.Assertions(function(item){
	try {
		assert(item);
	} catch (e) {
		if (e instanceof AssertException){
			e.fail().p();
		} 
	}
});
*/
</script>

</body>
</html>